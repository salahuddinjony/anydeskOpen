<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AnyDesk Connect</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div id="app">
    <main class="card">
      <div class="logo">
        <svg class="logo-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 15v-4H8l4-6 4 6h-3v4h-2z" fill="currentColor"/>
        </svg>
        <h1>AnyDesk Connect</h1>
      </div>
      <p class="subtitle">Enter the AnyDesk ID to connect remotely</p>

      <div class="form">
        <label for="anydesk-id">AnyDesk ID</label>
        <input
          id="anydesk-id"
          v-model="connectId"
          type="text"
          placeholder="e.g. 123 456 789"
          maxlength="14"
          @input="formatId"
        >
        <p v-if="error" class="error">{{ error }}</p>

        <div class="actions">
          <button class="btn btn-primary" @click="openAnyDesk" :disabled="!isIdValid">
            Open AnyDesk App
          </button>
          <button class="btn btn-secondary" @click="openWeb" :disabled="!isIdValid">
            Open in Browser
          </button>
        </div>

        <div class="fix-windows">
          <p class="fix-windows-title">Link doesn’t open on Windows?</p>
          <p class="fix-windows-desc">Download the .reg and run it. <strong>Right‑click the file → Run as administrator</strong> so Windows installs the handler. Then close and reopen your browser and try again.</p>
          <div class="fix-windows-buttons">
            <button type="button" class="btn btn-outline btn-sm" @click="downloadReg('64')">Fix (64-bit)</button>
            <button type="button" class="btn btn-outline btn-sm" @click="downloadReg('32')">Fix (32-bit)</button>
            <button type="button" class="btn btn-outline btn-sm" @click="downloadRegCurrentUser('64')">Fix (current user)</button>
          </div>
          <p class="fix-windows-custom-desc">AnyDesk not in Program Files? Find <strong>AnyDesk.exe</strong>, copy its full path, paste below, then download the .reg.</p>
          <input v-model="customExePath" type="text" class="fix-windows-input" placeholder="e.g. C:\Program Files\AnyDesk\AnyDesk.exe">
          <button type="button" class="btn btn-outline btn-sm fix-windows-custom-btn" @click="downloadRegCustom" :disabled="!customExePathTrim">Download .reg with this path</button>
          <div class="fix-windows-trouble">
            <p class="fix-windows-trouble-title">Still says “Launched external handler” but AnyDesk doesn’t open?</p>
            <ul class="fix-windows-trouble-list">
              <li>Run the .reg file <strong>as Administrator</strong> (right‑click → Run as administrator).</li>
              <li>Close the browser completely and open it again, then try “Open AnyDesk App”.</li>
              <li>Test the handler: press <strong>Win + R</strong>, type <code>"C:\Program Files\AnyDesk\AnyDesk.exe" "anydesk:1258004724"</code>, press Enter. If AnyDesk opens, the app works and the issue is the browser; try another browser (Chrome, Firefox, or Edge) or set a default app for <code>anydesk:</code> in Windows Settings → Apps → Default apps → Choose default apps by protocol.</li>
              <li>In Windows: Settings → Apps → Default apps → “Choose default apps by protocol” → look for “AnyDesk” or “anydesk” and set it to AnyDesk.</li>
            </ul>
          </div>
        </div>

        <div v-if="isIdValid" class="web-fallback">
          <p class="web-fallback-title">Web connect (if the link doesn’t open)</p>
          <p class="web-fallback-note">go.anydesk.com may be blocked on your network (firewall/VPN). Try the desktop app above, or use another network and open:</p>
          <a :href="webUrl" target="_blank" rel="noopener" class="web-link">{{ webUrl }}</a>
          <p class="web-fallback-id">Then enter this ID: <strong>{{ rawId }}</strong> <button type="button" class="btn-copy" @click="copyId">Copy ID</button></p>
          <p v-if="copyDone" class="copy-done">Copied to clipboard</p>
        </div>
      </div>

      <p class="hint">
        Prefer <strong>Open AnyDesk App</strong> if the app is installed. Use the browser option only when the app isn’t available.
      </p>
    </main>
  </div>

  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <script>
(function () {
  var createApp = Vue.createApp;
  var ANYDESK_WEB_URL = "https://go.anydesk.com";

  function makeRegContent(exePath) {
    return [
      "Windows Registry Editor Version 5.00",
      "",
      "[HKEY_CLASSES_ROOT\\anydesk]",
      "@=\"URL:AnyDesk Protocol\"",
      "\"URL Protocol\"=\"\"",
      "",
      "[HKEY_CLASSES_ROOT\\anydesk\\shell\\open\\command]",
      "@=\"\\\"" + exePath + "\\\" \\\"%1\\\"\""
    ].join("\r\n");
  }

  function makeRegContentCurrentUser(exePath) {
    return [
      "Windows Registry Editor Version 5.00",
      "",
      "[HKEY_CURRENT_USER\\Software\\Classes\\anydesk]",
      "@=\"URL:AnyDesk Protocol\"",
      "\"URL Protocol\"=\"\"",
      "",
      "[HKEY_CURRENT_USER\\Software\\Classes\\anydesk\\shell\\open\\command]",
      "@=\"\\\"" + exePath + "\\\" \\\"%1\\\"\""
    ].join("\r\n");
  }

  function downloadReg(bit) {
    var path64 = "C:\\Program Files\\AnyDesk\\AnyDesk.exe";
    var path32 = "C:\\Program Files (x86)\\AnyDesk\\AnyDesk.exe";
    var exePath = bit === "32" ? path32 : path64;
    var reg = makeRegContent(exePath);
    var blob = new Blob([reg], { type: "application/x-msdownload" });
    var a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "anydesk-protocol-fix-" + bit + "bit.reg";
    a.click();
    URL.revokeObjectURL(a.href);
  }

  function downloadRegCurrentUser(bit) {
    var path64 = "C:\\Program Files\\AnyDesk\\AnyDesk.exe";
    var path32 = "C:\\Program Files (x86)\\AnyDesk\\AnyDesk.exe";
    var exePath = bit === "32" ? path32 : path64;
    var reg = makeRegContentCurrentUser(exePath);
    var blob = new Blob([reg], { type: "application/x-msdownload" });
    var a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "anydesk-protocol-fix-current-user-" + bit + "bit.reg";
    a.click();
    URL.revokeObjectURL(a.href);
  }

  function downloadRegCustom(path) {
    path = (path || "").trim().replace(/\//g, "\\");
    if (!path) return;
    var exePath = path.replace(/\\/g, "\\\\");
    var reg = makeRegContent(exePath);
    var blob = new Blob([reg], { type: "application/x-msdownload" });
    var a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "anydesk-protocol-fix-custom.reg";
    a.click();
    URL.revokeObjectURL(a.href);
  }

  createApp({
    data: function () {
      return {
        connectId: "",
        error: "",
        copyDone: false,
        customExePath: ""
      };
    },
    computed: {
      rawId: function () {
        return this.connectId.replace(/\s/g, "");
      },
      isIdValid: function () {
        return /^\d{9,14}$/.test(this.rawId);
      },
      webUrl: function () {
        return this.rawId
          ? ANYDESK_WEB_URL + "?id=" + encodeURIComponent(this.rawId)
          : ANYDESK_WEB_URL;
      },
      customExePathTrim: function () {
        return this.customExePath.trim().length > 0;
      }
    },
    methods: {
      formatId: function (e) {
        var raw = e.target.value.replace(/\D/g, "");
        this.connectId = raw.replace(/(\d{3})(?=\d)/g, "$1 ").trim();
        this.error = "";
      },
      openAnyDesk: function () {
        if (!this.isIdValid) {
          this.error = "Please enter a valid 9–14 digit AnyDesk ID.";
          return;
        }
        this.error = "";
        window.location.href = "anydesk:" + this.rawId;
      },
      openWeb: function () {
        if (!this.isIdValid) {
          this.error = "Please enter a valid 9–14 digit AnyDesk ID.";
          return;
        }
        this.error = "";
        window.open(this.webUrl, "_blank", "noopener,noreferrer");
      },
      copyId: function () {
        var vm = this;
        if (!vm.rawId) return;
        navigator.clipboard.writeText(vm.rawId).then(function () {
          vm.copyDone = true;
          setTimeout(function () { vm.copyDone = false; }, 2000);
        });
      },
      downloadReg: downloadReg,
      downloadRegCurrentUser: downloadRegCurrentUser,
      downloadRegCustom: function () {
        downloadRegCustom(this.customExePath);
      }
    }
  }).mount("#app");
})();
  </script>
</body>
</html>
